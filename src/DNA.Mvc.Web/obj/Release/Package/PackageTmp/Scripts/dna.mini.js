(function(n){n.resolveUrl=function(t){var i="/";return window.appPath&&(i=window.appPath),n("body").data("root")&&(i=n("body").data("root")),t.startsWith("~/")?t.replace("~/",i):void 0},n.res=function(n,t){return res!=undefined&&res[n]?res[n]:t},n.widget("dna.page",{options:{id:0,container:".d-page",change:null},_create:function(){var r=this,n=this.options,i=this.widgetEventPrefix,t=this.element;return this._layoutchanged=!1,this._contentchanged=!1,this._layoutmpl=null,this._mode=!1,this._widgetsloaded=!1,n.change&&t.bind(i+"change",n.change),t},applyfor:function(t){n.loading(),n.post(n.resolveUrl("~/api/"+n("body").data("web")+"/pages/applyfor/"+this.options.id),{scope:t},function(){n.loading("hide")})},savestyle:function(t){n.loading(),n.post(n.resolveUrl("~/api/"+n("body").data("web")+"/pages/savestyle/"+this.options.id),{text:t},function(){n.loading("hide");var i=n("#inpagestyle",document);i.length==0&&(i=n("<style id='inpagestyle' type='text/css' />")),i.text(t)})},design:function(t){t==!1?(this._mode=="contents"&&this._unloadzones(),n(document).off("mouseup").off("mousemove")):this.loadwidgets(),this._mode=t},saveLayouts:function(){var r=n("<div/>").appendTo("body").hide(),o=n(".d-widget").appendTo(r),f=n(".d-state-design"),t,u,i,e;n("[data-role=layout]",f).layout("destroy"),t=f.clone(!1),u="",t.removeAttr("style"),n(".d-widget-zone-design",t).removeClass("d-widget-zone-design"),n(".d-layout",t).removeClass("d-layout"),n(".ui-sortable",t).removeClass("ui-sortable"),n(".ui-resizable",t).removeClass("ui-resizable"),n(".ui-droppable",t).removeClass("ui-droppable"),n(".d-state-selected",t).removeClass("d-state-selected"),u=t.html(),t.remove(),n("body>.d-page").remove(),n(".d-state-design>.d-page").appendTo("body").removeAttr("style"),n("[data-role=widgetzone]").each(function(t,i){n(i).widgetZone(),n(".d-widget[data-zone="+n(i).attr("id")+"]").appendTo(i)}),n("body>footer").appendTo("body"),n("body>.d-state-design").remove(),n.closePanels(),r.children().length&&(i=n("[data-role=widgetzone]:last"),e=i.attr("id"),r.children().each(function(t,r){n(r).appendTo(i).attr("data-zone",i.attr("id"))}),r.children().appendTo(i)),n.post(n.resolveUrl("~/api/"+n("body").data("web")+"/pages/applylayout/"+n("body").data("id")+"?locale="+n("body").attr("lang")),{name:"",data:u,dir:"lrt",viewmode:""},function(){})},designLayouts:function(){var t=n("<div/>").addClass("d-state-design").appendTo("body").height(n(document).height()).width(n(document).width()-342).css("z-index",n.topMostIndex());n(".d-page").clone(!1).appendTo(t),n("[data-role=widget]",t).remove(),n("[data-role=layout]",t).layout(),n.closePanels(),n("#layouttools_panel").taoPanel("open"),this.enableLayoutTmpls()},enableLayoutTmpls:function(){n(".d-layout-tmpl").draggable({appendTo:"body",cursor:"move",cursorAt:{left:30,top:15},helper:function(){var t=n(this).clone();return t.children("span").remove(),n("<div/>").addClass("d-layout-tmpl-helper").html("<span>Add <\/span>"+t.html()+" <span style='margin-right:5px;'>to<\/span><span data-name='targetholder'> ... <\/span>").css("z-index",n.topMostIndex())}})},cancelLayouts:function(){n("body>.d-state-design").remove(),n.closePanels()},loadTmpl:function(t){var i=this;n.loading(),n(this.options.container).load(n.resolveUrl("~/dynamicui/layout/"+t+"?locale="+n("body").attr("lang")),function(){n.loading("hide"),i._layoutmpl=t,i.design("layouts"),n("body").trigger("layoutchange"),i._layoutchanged=!1})},loadwidgets:function(){var t=this;return n.get(n.resolveUrl("~/api/"+n("body").data("web")+"/widgets?id="+n("body").data("id")),function(i){var r=n("[data-role='widgetzone']");r.each(function(t,r){var u=n(r),o=u.attr("id"),f=[],e;n.each(i,function(n,t){t.zone==o&&f.push(t)}),e=f.sort(function(n,t){return n.pos>t.pos?1:-1}),u.empty(),n.each(e,function(t,i){n("<div id='widget_"+i.id+"'/>").attr("data-role","widget").appendTo(u).widget(i)}),u.widgetZone()}),t._widgetsloaded=!0}),this},getTopLayout:function(){var i=n("[data-role='layout']"),t=null;return t=n("[data-role=layout]:first",n("body"))},styleChanged:function(){this._layoutchanged=!0,n("#btnSavePageChange").isDisable(!1)},reset:function(){n.loading(),n.post(n.resolveUrl("~/api/"+n("body").data("web")+"/pages/reset/"+this.options.id),{includeLayout:!0},function(){location.reload()})},_unloadlayouts:function(){n("body").removeClass("d-state-design"),n("[data-role='layout']").layout("destroy"),n("[data-role='widgetzone']").off("click")},_unloadzones:function(){n("[data-role='widgetzone']").widgetZone("destroy"),n("[data-role='widget']").widget("destroy")},_triggerEvent:function(n,t){return this.element.trigger(this.widgetEventPrefix+n,t),this},destroy:function(){this.element.unbind(this.widgetEventPrefix+"change"),n("body").off("layoutchange").off("click"),n.Widget.prototype.destroy.call(this)}})})(jQuery),function(n){n.widget("dna.widget",{options:{id:null,title:null,link:null,icon:null,contentUrl:null,closable:!0,isStatic:!1,expanded:!0,cssText:null,headerCssText:null,b...){var r=this,i=this.options,t=this.element;return t.data("id")!=undefined&&(i.objectID=t.dataInt("id")),t.data("auto-check")!=undefined&&(i.autocheck=t.dataBool("auto-check")),t.data("isfollowing")!=undefined&&(i.isfollowing=t.dataBool("isfollowing")),t.data("user")&&(i.userName=t.data("user")),t.data("follow-url")&&(i.followUrl=t.data("follow-url")),t.data("unfollow-url")&&(i.followUrl=t.data("unfollow-url")),t.data("following-url")&&(i.checkUrl=t.data("following-url")),t.data("follow-text")&&(i.followText=t.data("follow-text")),t.data("unfollow-text")&&(i.unfollowText=t.data("unfollow-text")),n.dna.taoButton.prototype._unobtrusive.call(this)}})}(jQuery),function(n,t,i,r){$DNA_Web=function(){this.name=n("body").data("web"),this.lang=n("body").attr("lang");var t=this;this.cats={load:function(i){var u=n.Deferred();return n.ajax(n.resolveUrl("~/api/"+t.name+"/"+t.lang+"/cats/items/"+(i!=r?i:0))).done(function(n){return u.resolve(n)}).fail(function(t,i,r){return n.err(r),u.reject()}),u},add:function(i){var r=n.Deferred();return n.post(n.resolveUrl("~/api/"+t.name+"/"+t.lang+"/cats/add"),i).done(function(n){return r.resolve(n)}).fail(function(t,i,u){return n.err(u),r.reject()}),r},remove:function(i){var r=n.Deferred();return n.post(n.resolveUrl("~/api/"+t.name+"/"+t.lang+"/cats/delete/"+i)).done(function(n){return r.resolve(n)}).fail(function(t,i,u){return n.err(u),r.reject()}),r},move:function(i,r){var u=n.Deferred();return n.post(n.resolveUrl("~/api/"+t.name+"/"+t.lang+"/cats/move/"+i),{parentID:r}).done(function(n){return u.resolve(n)}).fail(function(t,i,r){return n.err(r),u.reject()}),u},update:function(i){var r=n.Deferred();return n.post(n.resolveUrl("~/api/"+t.name+"/"+t.lang+"/cats/update"),i).done(function(n){return r.resolve(n)}).fail(function(t,i,u){return n.err(u),r.reject()}),r}}},n.extend($DNA_Web.prototype,{localizeTo:function(t){if(t==r&&n.err("app.web.localizeTo : The target language no set"),t==this.lang){n.notify("Current website already using "+t);return}n.loading();var i=n.resolveUrl("~/dashboard/"+this.name+"/"+t+"/settings");return n.ajax({type:"POST",url:n.resolveUrl("~/api/"+this.name+"/langs/copy?locale="+this.lang),data:{to:t},complete:function(){n.loading("hide")},success:function(){location=i},error:function(t,i,r){n.err(r)}})},switchTo:function(t){if(t==r&&n.err("app.web.switchTo : The target language no set"),t==this.lang){n.notify("Current website already using "+t);return}return n.loading(),n.ajax({type:"POST",url:n.resolveUrl("~/api/"+this.name+"/langs/switch"),data:{to:t},complete:function(){n.loading("hide")},success:function(){location.reload()},error:function(t,i,r){n.err(r)}})}}),$DNA_Page=function(t){this.parent=t,this.id=n("body").data("id"),this.title=n("title").text(),this.description=n("meta[name=description]").attr("content"),this.keywords=n("meta[name=keywords]").attr("content")},n.extend($DNA_Page.prototype,{getWidgets:function(t){var i=this;return n.ajax({url:n.resolveUrl("~/api/"+this.parent.name+"/widgets?id="+this.id)}).done(function(r){n.isFunction(t)&&t(r),i.widgets=r}),this},getZones:function(){},reset:function(){return n.loading(),n.ajax({url:n.resolveUrl("~/api/"+this.parent.name+"/pages/reset/"+this.id),type:"post",data:{includeLayout:!0},complete:function(){n.loading("hide")}})},extractKeywords:function(){var t=[];return n("h1,h2,h3,h4,h5,h6",n(".d-page")).each(function(i,r){var u=n(r).text();u&&n.inArray(u,t)==-1&&t.push(n.trim(u.replace("\t","").replace("\n","")))}),n("[title]",n(".d-page")).each(function(i,r){var u=n(r).attr("title");u&&n.inArray(u,t)==-1&&t.push(n.trim(u.replace("\t","").replace("\n","")))}),t}}),$DNA_FUC_InstallPKG=function(t,i,r,u){return n.ajax({url:n.resolveUrl("~/api/cloud/install/"+i),data:{type:t,name:r,category:u},error:function(t,i,r){n.err(r)}})},$DNA_Application=function(){this.web=new $DNA_Web,this.page=new $DNA_Page(this.web),this.widgets={install:function(n,t,i){return $DNA_FUC_InstallPKG("widget",n,t,i)},uninstall:function(t,i){return n.ajax({type:"POST",url:n.resolveUrl("~/api/widgets/uninstall"),data:{name:t,category:i},error:function(t,i,r){n.err(r)}})},enable:function(t,i){return n.ajax({type:"POST",url:n.resolveUrl("~/api/widgets/register"),data:{name:t,category:i},error:function(t,i,r){n.err(r)}})},disable:function(t){return n.ajax({type:"POST",url:n.resolveUrl("~/api/widgets/unregister"),data:{id:t},error:function(t,i,r){n.err(r)}})},update:function(t){return n.ajax({type:"POST",url:n.resolveUrl("~/api/widgets/update"),data:{id:t},error:function(t,i,r){n.err(r)}})}},this.themes={install:function(n,t){return $DNA_FUC_InstallPKG("theme",n,t)}},this.contentTypes={install:function(n,t){return $DNA_FUC_InstallPKG("list",n,t)},uninstall:function(t){return n.ajax({type:"POST",url:n.resolveUrl("~/api/cloud/uninstall"),data:{name:t,type:"contentType"},error:function(t,i,r){n.err(r)}})}}},n.extend($DNA_Application,{login:function(){},logout:function(){}}),n(function(){t.app=new $DNA_Application})}(jQuery,window,document)