(function(n,t,i,r){n.extend(String.prototype,{startsWith:function(t){return n.type(this)=="string"?this.slice(0,t.length)==t:!1},endsWith:function(t){return n.type(this)=="string"?this.slice(-t.length)==t:!1},contains:function(t){return n.type(this)=="string"?this.indexOf(t)>-1:!1},isUrl:function(){var n=/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/;return n.test(this)}}),tao={},tao.mapper=function(n,t){n!=r&&(this._init(n),t!=r&&(this.filter=t))},tao.mapper.prototype={schema:{},_init:function(t){t&&n.extend(this.schema,t)},data:function(t){return n.isArray(t)?t:t.Model!=r?t.Model:t},total:function(t){return n.isArray(t)?t.length:t.Total!=r?t.Total:void 0},filter:null,convert:function(t){var f=this,u,i;return this.schema&&!n.isEmptyObject(this.schema)&&n.isArray(t)?(u=this.schema,i=[],n.each(t,function(t,e){var o={},s,h;for(s in u)o[s]=e[u[s]];n.isFunction(f.filter)?(h=f.filter(e,o),(h==r||h==!0)&&i.push(o)):i.push(o)}),i):t},map:function(t){var i=n.isFunction(this.data)?this.data(t):t,r=n.isFunction(this.total)?this.total(t):0;return n.isFunction(this.convert)&&(i=this.convert(i)),{total:r,data:i}},setup:function(t){var r=n(t),i=n("[data-role='schema']",t);return i.length&&this._setupSchema(i),this._setupMethods(t),n(t)},_setupSchema:function(t){var r={},i=n("[data-to]",t);i.length==0?(i=n("[data-field]",t),i.each(function(t,i){var u=n(i).data("field"),f=n(i).text();u&&f&&(r[n.trim(u)]=n.trim(f))})):i.each(function(t,i){var u=n(i).data("to"),f=n(i).data("from");u&&f&&(r[n.trim(u)]=n.trim(f))}),this.schema=r},_setupMethods:function(n){n.data("filter")&&(this.filter=new Function("dataItem","output",n.data("filter"))),n.data("data")&&(this.data=new Function("data",n.data("data"))),n.data("total")&&(this.total=new Function("data",n.data("total"))),n.data("convert")&&(this.convert=new Function("data",n.data("convert")))}},n.fn.mapper=function(){var T=new tao.mapper,_type;return this.data("instance")?this.data("instance"):(this.data("type")&&(_type=this.data("type"),n.isFunction(eval(_type))&&(T=eval("new "+_type+"()"))),T.setup(this),this.data("instance",T),this.hide(),T)},tao.xmlMapper=function(n){this._init(n)},n.extend(tao.xmlMapper.prototype,tao.mapper.prototype),n.extend(tao.xmlMapper.prototype,{schema:{tagName:"node",fields:[{name:"text",role:"attribute",ref:"text"},{name:"img",role:"attribute",ref:"imageUrl"},{name:"link",role:"attribute",ref:"navigateUrl"},{name:"rel",role:"attribute",ref:"rel"},{name:"url",role:"attribute",ref:"dataUrl"},{name:"disabled",role:"attribute",ref:"disabled"},{name:"checked",role:"attribute",ref:"checked"},{name:"expanded",role:"attribute",ref:"expanded"}]},_getTypedValue:function(t){return t!=r?n.isNumeric(t)?t.indexOf(".")>-1?parseFloat(t):parseInt(t):t.indexOf("/Date(")>-1?new Date(parseInt(t.substring(6,19))):t.toLowerCase()=="true"?!0:t.toLowerCase()=="false"?!1:t:""},_mapNode:function(t){var i={},r=this;return n.each(this.schema.fields,function(n,u){var f=u.name.toString();u.role=="attribute"?t.attr(u.ref)&&(i[f]=r._getTypedValue(t.attr(u.ref))):i[f]=u.role=="element"?t.text():t[0].tagName}),i},convert:function(t){var i=this,f=function(t,u){t.each(function(t,e){var o=i._mapNode(n(e)),s;n.isArray(u)?u.push(o):(u.children==r&&(u.children=[]),u.children.push(o)),s=i.schema.tagName?n(e).children(i.schema.tagName):n(e).children(),s.length&&f(s,o)})},u;return t?(u=[],f(n(t.documentElement).children(),u),u):t}}),tao.htmlSelectMapper=function(){},n.extend(tao.htmlSelectMapper.prototype,tao.mapper.prototype,{convert:function(t){var i=[];if(t){var f=function(n,t){for(var i=0;i<n.attributes.length;i++)n.attributes[0].name.startsWith("data-")&&(_name=n.attributes[0].name.replace("data-",""),t[_name]=n.attributes[0].value)},e=function(t){var i=n(t),u={label:i.text(),selected:i.attr("selected")!=r?i.attr("selected"):!1,value:i.attr("value")!=r?i.attr("value"):i.text()};return f(t,u),u},o=function(t){var i=[];return i.label=n(t).attr("label"),f(t,i),n(t).children().each(function(n,t){i.push(e(t))}),i},u=0;n(t).children().each(function(n,t){t.tagName.toLowerCase()=="option"?i.push(e(t)):(i.push(o(t)),u++)}),u&&(i.groups=u)}return i}}),tao.htmlTableMapper=function(){},n.extend(tao.htmlTableMapper.prototype,tao.mapper.prototype,{convert:function(t){var f,e,u,i,o;return n.isArray(t)||n.isPlainObject(t)?t:(f=n(">thead th,>thead td",n(t)),e=this,this.schema={columns:[]},u=[],f.each(function(t,i){e.schema.columns.push({name:n(i).attr("data-field")?n(i).attr("data-field"):n.trim(n(i).text()),title:n.trim(n(i).text()),width:n(i).data("width")!=r?n(i).dataInt("width"):0,type:n(i).attr("data-type")?n(i).attr("data-type"):"string"})}),i=this.schema.columns,o=n(t).children(":not(thead)").find("tr"),o.each(function(t,f){var o=n(f),e;o.parent()[0].tagName.toLowerCase()!="thead"&&(e={},n(">td",o).each(function(t,u){var f=n.trim(n(u).html()),o=null;isNaN(parseFloat(f))||(o=parseFloat(f)),(f=="True"||f=="true")&&(o=!0),(f=="False"||f=="false")&&(o=!1),o==null&&(o=f),i[t...se),n("<div/>").addClass("d-photo-viewer-header").appendTo(r).append(n("<a/>").attr("role","link").text("["+i.closeText+"]").click(function(){n(window).unbind("keyup"),t.destroy(),t._triggerEvent("close")})),f=n("<div/>").addClass("d-photo d-sidebar d-tran").appendTo(r),this._sidebar=f,f.hide(),this._container=n("<div/>").addClass("d-photo-container").attr("tabIndex",0).appendTo(r),this._setSize(),window.addEventListener("resize",n.proxy(t._setSize,t),!1),u.length){i.src&&(i.index=u.indexOf(i.src)),this._loadPhoto(u[i.index]);this._container.on("mouseup",function(i){if(!t.isDagging&&i.button!=0){i.preventDefault();var r=i.clientX;r>n(this).width()/2?t.next():t.prev()}});n("<div/>").addClass("d-photo-nav-left d-tran").appendTo(r).append(n("<span/>").addClass(" d-icon-arrow-left-2")).click(function(){t.prev()}),n("<div/>").addClass("d-photo-nav-right d-tran").appendTo(r).append(n("<span/>").addClass("d-icon-untitled")).click(function(){t.next()})}else i.src&&this._loadPhoto(i.src);this.proportion=1,this._container.on("mousewheel",function(n,i){t.proportion<.3&&i>0||t.proportion>4&&i<0||(t.proportion-=i/10,t._scale(t.proportion))}).on("dblclick",function(){var i=n(">img",this);i.length&&(t.proportion=1,t._scale(1),i.position({my:"center center",at:"center center",of:t._container}))}).bind("contextmenu",function(){return!1}),n(window).bind("keyup",function(i){i.keyCode==27&&(n(window).unbind("keyup"),t.destroy(),t._triggerEvent("close")),u.length&&(console.log(i.keyCode),i.keyCode==37&&t.prev(),i.keyCode==39&&t.next())})},next:function(){var n=this.options;n.index++,n.index>=this.photos.length&&(n.index=0),this._loadPhoto(this.photos[n.index])},prev:function(){var n=this.options;n.index==0?n.index=this.photos.length-1:n.index--,this._loadPhoto(this.photos[n.index])},_loadPhoto:function(t){var i=this,u,r;this._container.empty(),u=n("<div>").appendTo(this._container).text(this.options.loadingText).addClass("d-photo-loader"),r=new Image,n(r).bind("load",function(){u.remove(),n(this).appendTo(i._container).position({my:"center center",at:"center center",of:i._container}).animate({opacity:"1"},500).draggable({start:function(){i.isDagging=!0},stop:function(){i.isDagging=!1}}),(n(this).width()>i._container.width()||n(this).height()>i._container.height())&&(i.proportion=.6,i._scale(i.proportion))}).css({"max-height":this._container.height()+"px","max-width":this._container.widget+"px"}),r.src=t},_unobtrusive:function(){var n=this.element,t=this.options;n.data("items")&&(t.items=n.datajQuery("items")),n.data("src-attr")&&(t.itemAttr=n.data("src-attr")),n.attr("data-index")!=undefined&&(t.index=parseInt(n.attr("data-index"))),n.data("src")&&(t.src=n.data("src")),n.data("loading-text")&&(t.loadingText=n.data("loading-text")),n.data("close-text")&&(t.closeText=n.data("close-text"))},_setSize:function(){var t,i;n("body").css("overflow","hidden"),t=n(window).height()-50,i=n(window).width(),this.viewer.height(n(window).height()).width(i);var f=n(".d-photo-tools",this.viewer),r=this._sidebar,u=this._container;r.isVisible()?(u.height(t).width(i-r.outerWidth(!0)-10).css({"line-height":t+"px"}),r.height(t),f.css({left:u.width()/2-f.width()/2+"px"})):(u.height(t).width(i-10).css({"line-height":t+"px"}),r.height(t))},_buildImg:function(t,i){var s=this,o=i.width/i.height,u=n(t).height(),e=n(t).width(),r,f;clientHeight=i.height,clientWidth=i.width,wrapper=n("<div/>").addClass("d-photo-wrapper").appendTo(t),r=n("<img/>").appendTo(wrapper),f=n("<img/>").appendTo(wrapper).hide(),clientHeight>clientWidth?clientHeight>u&&(clientHeight=u,clientWidth=Math.round(clientHeight*o)):clientWidth>e&&(clientWidth=e,clientHeight=Math.round(e/o)),clientHeight=clientHeight-10,clientWidth=clientWidth-10,r.width(clientWidth).height(clientHeight),f.width(clientWidth).height(clientHeight),wrapper.width(clientWidth).height(clientHeight).css({"margin-top":u/2-clientHeight/2+"px"}),r.attr("src",i.url+"?w=300&h="+i.height+"&ratio=true&enlage=false"),f.one("load",function(){f.show(),r.animate({opacity:0},function(){r.hide()})}).bind("dblclick",function(){s._scale(1),wrapper.css({"margin-top":u/2-clientHeight/2+"px",top:"0px",left:"0px"})}).attr("src",i.url),wrapper.addClass("d-tran-fast")},_scale:function(t){var i=n(">img",this._container);i.css({transform:"scale("+t+")","-webkit-transform":"scale("+t+")","-o-transform":"scale("+t+")","-moz-transform":"scale("+t+")"})},_rotate:function(t){var i=n(">.d-photo-wrapper",this._container);this._scale(1),i.css({transform:"rotateZ("+t+"deg)","-webkit-transform":"rotateZ("+t+"deg)","-o-transform":"rotateZ("+t+"deg)","-moz-transform":"rotateZ("+t+"deg)"})},_buildHeader:function(t,i){return n("<h2/>").addClass("d-header2").appendTo(t).text(i)},_triggerEvent:function(n,t){return this.element.trigger(this.widgetEventPrefix+n,t),this},destroy:function(){this.viewer.remove(),n("body").css("overflow","auto"),window.removeEventListener("resize",n.proxy(self._setSize,self),!1),n.Widget.prototype.destroy.call(this)}})}(jQuery)